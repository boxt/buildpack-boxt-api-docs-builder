#!/bin/sh

# bin/compile BUILD_DIR CACHE_DIR ENV_DIR
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

cd $BUILD_DIR

echo "DATABASE_URL:$DATABASE_URL"
export DATABASE_URL=`cat $ENV_DIR/DATABASE_URL`
export RAILS_ENV=`cat $ENV_DIR/RAILS_ENV`
export RACK_ENV=`cat $ENV_DIR/RACK_ENV`

export DATABASE_FILE_CONTENT=<<-YAML
$RAILS_ENV:
  url: "$DATABASE_URL"

YAML

echo $DATABASE_FILE_CONTENT >> config/database.yml

bin/rake docs:api:build -- --api-class-name=V2::API --base-dir="$BUILD_DIR/public/api-docs"
exit 0
